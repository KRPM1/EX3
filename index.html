
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심혈관계 질환 발생 위험도(KRPM)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #FF4B5C;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 30px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            text-align: center;
            color: #FF4B5C;
        }
        input, select {
            margin-bottom: 15px;
            padding: 10px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            padding: 10px;
            width: 100%;
            background-color: #FF4B5C;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #e04352;
        }
        .result, .risk-category {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            color: #333;
        }
        canvas {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>심혈관계 질환 발생 위험도(KRPM)</h1>

    <form id="khs-form">
        <select id="gender" required>
            <option value="">성별 선택</option>
            <option value="male">남성</option>
            <option value="female">여성</option>
        </select>

        <input type="number" id="age" placeholder="나이 (age)" required>
        <input type="number" id="tc" placeholder="총 콜레스테롤 (Total Cholesterol)" required>
        <input type="number" id="hdl" placeholder="HDL 수치 (HDL-cholesterol)" required>

        <select id="tut" required>
            <option value="">혈압약 복용 여부</option>
            <option value="0">아니오</option>
            <option value="1">예</option>
        </select>

        <input type="number" id="sbp" placeholder="수축기 혈압 (systolic BP)" required>

        <select id="cs" required>
            <option value="">현재 흡연 여부</option>
            <option value="0">아니오</option>
            <option value="1">예</option>
        </select>

        <select id="d" required>
            <option value="">당뇨병 유무</option>
            <option value="0">아니오</option>
            <option value="1">예</option>
        </select>

        <button type="button" onclick="calculateKHS()">계산하기</button>
    </form>

    <div class="result" id="result"></div>
    <div class="risk-category" id="risk-category"></div>
    <canvas id="riskChart" width="300" height="300"></canvas>
</div>

<script>
let chartInstance = null;

function calculateKHS() {
    const gender = document.getElementById("gender").value;
    const age = Number(document.getElementById("age").value);
    const tc = Number(document.getElementById("tc").value);
    const hdl = Number(document.getElementById("hdl").value);
    const tut = Number(document.getElementById("tut").value);
    const sbp = Number(document.getElementById("sbp").value);
    const cs = Number(document.getElementById("cs").value);
    const d = Number(document.getElementById("d").value);

    const lnA = Math.log(age);
    const lnA2 = lnA * lnA;
    const lnTC = Math.log(tc);
    const lnHDL = Math.log(hdl);
    const lnSBP = Math.log(sbp);

    let KSUM, SUM, baseline;

    if (gender === "male") {
        if (tut === 0) {
            KSUM = 19.362 * lnA + 2.425 * lnA2 + 6.409 * lnTC - 1.430 * lnA * lnTC
                - 3.843 * lnHDL + 0.810 * lnHDL * lnA
                + 18.541 * lnSBP - 4.112 * lnA * lnSBP
                + 2.464 * cs - 0.503 * cs * lnA
                + 0.410 * d;
            SUM = 9.362 * 3.902 + 2.425 * 15.253 + 6.409 * 5.263
                - 1.430 * 20.538 - 3.843 * 3.847 + 0.810 * 15.014
                + 18.541 * 4.555 - 4.112 * 17.754
                + 2.464 * 0.496 - 0.503 * 1.923 + 0.410 * 0.101;
            baseline = 0.9647;
        } else {
            KSUM = 19.362 * lnA + 2.425 * lnA2 + 6.409 * lnTC - 1.430 * lnA * lnTC
                - 3.843 * lnHDL + 0.810 * lnHDL * lnA
                + 18.589 * lnSBP - 4.116 * lnA * lnSBP
                + 2.464 * cs - 0.503 * cs * lnA
                + 0.410 * d;
            SUM = 9.362 * 3.902 + 2.425 * 15.253 + 6.409 * 5.263
                - 1.430 * 20.538 - 3.843 * 3.847 + 0.810 * 15.014
                + 18.589 * 0.262 - 4.116 * 1.049
                + 2.464 * 0.496 - 0.503 * 1.923 + 0.410 * 0.101;
            baseline = 0.9647;
        }
    } else {
        if (tut === 0) {
            KSUM = -9.519 * lnA + 3.417 * lnA2 + 0.320 * lnTC
                - 0.476 * lnHDL + 13.291 * lnSBP - 2.876 * lnA * lnSBP
                + 0.415 * cs + 0.424 * d;
            SUM = -9.519 * 3.935 + 3.417 * 15.507 + 0.320 * 5.284
                - 0.476 * 3.965 + 13.291 * 4.483 - 2.876 * 17.616
                + 0.415 * 0.045 + 0.424 * 0.072;
            baseline = 0.96963;
        } else {
            KSUM = -9.519 * lnA + 3.417 * lnA2 + 0.320 * lnTC
                - 0.476 * lnHDL + 13.402 * lnSBP - 2.889 * lnA * lnSBP
                + 0.415 * cs + 0.424 * d;
            SUM = -9.519 * 3.935 + 3.417 * 15.507 + 0.320 * 5.284
                - 0.476 * 3.965 + 13.402 * 0.329 - 2.889 * 1.326
                + 0.415 * 0.045 + 0.424 * 0.072;
            baseline = 0.96963;
        }
    }

    const x = KSUM - SUM;
    const y = Math.exp(x);
    const khs = (1 - Math.pow(baseline, y)) * 100;
    const khsRounded = Math.round(khs * 10) / 10;

    document.getElementById("result").innerText = `당신의 10년 ASCVD 위험도는 약 ${khsRounded}% 입니다.`;

    // 위험군 분류
    let riskCategory = "";
    if (khsRounded >= 20) {
        riskCategory = "고위험군입니다. 전문의 상담을 권장합니다.";
    } else if (khsRounded >= 10) {
        riskCategory = "중위험군입니다. 생활습관 개선을 추천합니다.";
    } else {
        riskCategory = "저위험군입니다. 현재 건강한 상태를 유지하세요.";
    }
    document.getElementById("risk-category").innerText = riskCategory;

    // 그래프
    const ctx = document.getElementById('riskChart').getContext('2d');
    if (chartInstance) {
        chartInstance.destroy();
    }
    chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['위험도', '나머지'],
            datasets: [{
                data: [khsRounded, 100 - khsRounded],
                backgroundColor: ['#FF4B5C', '#f0f0f0'],
                borderWidth: 1
            }]
        },
        options: {
            cutout: '70%',
            plugins: {
                legend: { display: false }
            }
        }
    });
}
</script>

</body>
</html>
